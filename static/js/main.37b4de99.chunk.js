(this["webpackJsonpmtg-collection"]=this["webpackJsonpmtg-collection"]||[]).push([[0],{50:function(e,t,n){e.exports=n(88)},88:function(e,t,n){"use strict";n.r(t);var a,r=n(0),i=n.n(r),c=n(43),l=n.n(c),o=n(1),s=n.n(o),u=n(6),d=n(44),m={files:{collection:""},decks:{collection:[]},cardList:{}},p=i.a.createContext([m,void 0]),f=n(16),g=n(17),h=n(19),v=(a={files:function(e,t){switch(t.type){case"SetDeckLink":return Object(g.a)({},e,Object(f.a)({},t.name,t.link));case"DeleteDeck":return Object(g.a)({collection:""},Object(h.omit)(e,[t.name]))}return e},cardList:function(e,t){switch(t.type){case"AddCard":return Object(g.a)({},e,Object(f.a)({},t.card.name,t.card))}return e},decks:function(e,t){switch(t.type){case"UpdateDeck":return Object(g.a)({},e,Object(f.a)({},t.name,t.cardList));case"DeleteDeck":return Object(g.a)({collection:[]},Object(h.omit)(e,[t.name]))}return e}},function(e,t){var n={};for(var r in a)n[r]=a[r](e[r],t);return n}),b=n(45),w=n.n(b),E=function(e){return e.split("\n").filter((function(e){return!e.match(/^\s*$/)&&!e.startsWith("//")})).map((function(e){return e.match(/^(\d*) (?:\[(.*)\] )?(.*)$/)})).filter((function(e){return!Object(h.isNull)(e)})).map((function(e){return{amount:parseInt(e[1]),name:e[3],set:e[2]}}))},k=function(e){var t,n=w.a.parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:"greedy"});return(null===(t=n.errors)||void 0===t?void 0:t.length)>0&&n.errors.forEach(console.error),n.data.map((function(e){var t,n,a;return{amount:e.amount,name:null!==(t=e.name)&&void 0!==t?t:e.card_name,isFoil:null!==(n=e.isFoil)&&void 0!==n?n:1===e.is_foil,set:null!==(a=e.set)&&void 0!==a?a:e.set_code,comment:e.comment}}))},y={parse:function(e){return e&&""!==e?e.match(/^([\D_]+,?)+/)?k(e):E(e):[]}},C=n(20),x={apiKey:"AIzaSyBcke75SLGGCMiId3EcThDcLnbmnKasWyE",clientId:"213841300532-aqinavnoi53if8cbk6re0aa6gkf965q3.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scope:"profile https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file"},O=function(e){var t,n,a,r,i,c,l,o,u;return s.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:return t=e.name,n=e.fileContent,a=e.folder,r=new Blob([n],{type:"text/plain"}),i={name:t,mimeType:"text/plain",parents:["appDataFolder"].concat(Object(C.a)(a))},c=gapi.auth.getToken().access_token,(l=new FormData).append("metadata",new Blob([JSON.stringify(i)],{type:"application/json"})),l.append("file",r),d.next=9,s.a.awrap(fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id",{method:"POST",headers:new Headers({Authorization:"Bearer "+c}),body:l}));case 9:return o=d.sent,d.next=12,s.a.awrap(o.json());case 12:return u=d.sent,d.abrupt("return",u.id);case 14:case"end":return d.stop()}}))},j=function(e){var t,n,a,r;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.id,i.next=3,s.a.awrap(gapi.client.drive.files.get({fileId:t,alt:"media"}));case 3:return n=i.sent,a=n.body.split("\n"),r=a.slice(4,a.length-2).join("\n"),i.abrupt("return",r);case 7:case"end":return i.stop()}}))},I={initClient:function(e){gapi.load("client:auth2",(function(){gapi.client.init(x).then((function(){gapi.auth2.getAuthInstance().isSignedIn.listen(e),e(gapi.auth2.getAuthInstance().isSignedIn.get())}),console.error)}))},getProfile:function(){return gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile()},signIn:function(){return gapi.auth2.getAuthInstance().signIn()},signOut:function(){return gapi.auth2.getAuthInstance().signOut()},prepareAppData:function(){return function(e){var t,n,a,r;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.awrap(gapi.client.drive.files.list({spaces:"appDataFolder",fields:"nextPageToken, files(id, name)"}));case 2:if(a=i.sent,r=null===(t=a.result)||void 0===t?void 0:null===(n=t.files)||void 0===n?void 0:n.find((function(e){return"collection.txt"===e.name}))){i.next=14;break}return console.info("Creating collection"),i.t0=e,i.next=9,s.a.awrap(O({name:"collection.txt",fileContent:"",folder:[]}));case 9:i.t1=i.sent,i.t2={type:"SetDeckLink",name:"collection",link:i.t1},(0,i.t0)(i.t2),i.next=24;break;case 14:return console.info("Loading collection"),e({type:"SetDeckLink",name:"collection",link:r.id}),i.t3=e,i.t4=y,i.next=20,s.a.awrap(j({id:r.id}));case 20:i.t5=i.sent,i.t6=i.t4.parse.call(i.t4,i.t5),i.t7={type:"UpdateDeck",name:"collection",cardList:i.t6},(0,i.t3)(i.t7);case 24:case"end":return i.stop()}}))}},createNewFile:O,updateFile:function(e){var t,n,a,r,i,c,l;return s.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.id,n=e.fileContent,a=new Blob([n],{type:"text/plain"}),r=gapi.auth.getToken().access_token,(i=new FormData).append("file",a),o.next=7,s.a.awrap(fetch("https://www.googleapis.com/upload/drive/v3/files/".concat(t,"?uploadType=media&fields=id"),{method:"PATCH",headers:new Headers({Authorization:"Bearer "+r}),body:i}));case 7:return c=o.sent,o.next=10,s.a.awrap(c.json());case 10:return l=o.sent,o.abrupt("return",l.id);case 12:case"end":return o.stop()}}))},getFileContents:j},D=n(21),S=n(46),A=function(e){return"https://via.placeholder.com/146x204?text=".concat(e.replace(/\s/,"+"))},F={getImage:function(e,t){var n,a,r;switch(e.layout){case"transform":case"double_faced_token":r=e.card_faces[0].image_uris;break;default:r=e.image_uris}return null!==(n=null===(a=r)||void 0===a?void 0:a[t])&&void 0!==n?n:A(e.name)},getPlaceholder:A},L=function(e){var t,n=e.style,a=Object(S.a)(e,["style"]),r=i.a.useContext(p),c=Object(u.a)(r,1)[0].cardList[a.name];switch(n){case"Minimal":return i.a.createElement("tr",{title:a.comment},i.a.createElement("td",null,a.amount,"x"),i.a.createElement("td",null,a.isFoil&&i.a.createElement("div",null,"(Foil)"),a.name),i.a.createElement("td",null,null!==(t=a.set)&&void 0!==t?t:"-"));case"Checklist":return i.a.createElement("tr",null,i.a.createElement("td",null,a.amount,"x"),i.a.createElement("td",null,a.isFoil&&i.a.createElement("div",null,"(Foil)"),a.name),i.a.createElement("td",null,c?c.mana_cost:"???"),i.a.createElement("td",null,a.set));case"Images":return i.a.createElement("img",{title:a.name,alt:a.name,src:c?F.getImage(c,"small"):F.getPlaceholder(a.name)});case"Full":return i.a.createElement("div",null,"PLACEHOLDER")}},T=function(e){var t=e.deckName,n=i.a.useContext(p),a=Object(u.a)(n,2),r=a[0],c=a[1],l=r.decks[t],o=i.a.useState("Minimal"),s=Object(u.a)(o,2),d=s[0],m=s[1];return i.a.useEffect((function(){var e,t=l.filter((function(e){return!r.cardList[e.name]}));console.log({deck:l,missingCards:t}),(e=D.Cards).collection.apply(e,Object(C.a)(t.map((function(e){return e.set?D.CardIdentifier.byName(e.name,e.set):D.CardIdentifier.byName(e.name)})))).on("data",(function(e){return c({type:"AddCard",card:e})}))}),[l,c,r.cardList]),i.a.createElement("div",null,i.a.createElement("div",null,"Deck: ",t),i.a.createElement("div",null,i.a.createElement("div",null,"Style:"),i.a.createElement("button",{disabled:"Minimal"===d,onClick:function(){return m("Minimal")}},"Minimal"),i.a.createElement("button",{disabled:"Checklist"===d,onClick:function(){return m("Checklist")}},"Checklist"),i.a.createElement("button",{disabled:"Images"===d,onClick:function(){return m("Images")}},"Images"),i.a.createElement("button",{disabled:"Full"===d,onClick:function(){return m("Full")}},"Full")),"Minimal"===d||"Checklist"===d?i.a.createElement("table",null,"Minimal"===d&&i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"#"),i.a.createElement("th",null,"Card name"),i.a.createElement("th",null,"Set"))),"Checklist"===d&&i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"#"),i.a.createElement("th",null,"Card name"),i.a.createElement("th",null,"Mana cost"),i.a.createElement("th",null,"Set"))),i.a.createElement("tbody",null,l.map((function(e,t){return i.a.createElement(L,Object.assign({style:d,key:t},e))})))):i.a.createElement("div",null,l.map((function(e,t){return i.a.createElement(L,Object.assign({style:d,key:t},e))}))))},M=function(e){var t=e.onImport,n=i.a.useState(""),a=Object(u.a)(n,2),r=a[0],c=a[1];return i.a.createElement("div",null,i.a.createElement("textarea",{value:r,onChange:function(e){return c(e.target.value)}}),i.a.createElement("button",{onClick:function(){return t(r)}},"Import collection"))},P=n(47),_=n(12),N=function(){var e=i.a.useReducer(v,m),t=Object(u.a)(e,2),n=t[0],a=t[1],r=i.a.useState(!1),c=Object(u.a)(r,2),l=c[0],o=c[1],f=i.a.useState(),g=Object(u.a)(f,2),h=g[0],b=g[1],w=function(){I.signOut(),b(void 0)};i.a.useEffect((function(){I.initClient((function(e){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(o(e),e){t.next=3;break}return t.abrupt("return");case 3:b(I.getProfile()),I.prepareAppData()(a);case 5:case"end":return t.stop()}}))}))}),[]);var E=function(e){I.updateFile({id:n.files.collection,fileContent:e}),a({type:"UpdateDeck",name:"collection",cardList:y.parse(e)})},k=function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,s.a.awrap(I.getFileContents({id:n.files.collection}));case 3:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 5:case"end":return e.stop()}}))};return console.log({url:"/MTGCollection"}),i.a.createElement(P.a,{basename:"/MTGCollection"},i.a.createElement(_.a,{to:l?"/":"/signin"}),i.a.createElement(_.d,null,i.a.createElement(_.b,{exact:!0,path:"/",render:function(){return i.a.createElement(p.Provider,{value:[n,a]},i.a.createElement("button",{onClick:w},"Sign Out"),!Object(d.isNullOrUndefined)(h)&&i.a.createElement("div",null,i.a.createElement("img",{src:h.getImageUrl(),alt:"Profile"}),i.a.createElement("div",null,"Welcome back, ",h.getGivenName())),i.a.createElement(M,{onImport:E}),i.a.createElement("button",{onClick:k},"Export collection"),i.a.createElement(T,{deckName:"collection"}))}}),i.a.createElement(_.b,{exact:!0,path:"/signin/",render:function(){return i.a.createElement("button",{onClick:I.signIn},"Sign in to google")}})))},W=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function B(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}l.a.render(i.a.createElement(N,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/MTGCollection",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/MTGCollection","/service-worker.js");W?(!function(e,t){fetch(e).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):B(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):B(t,e)}))}}()}},[[50,1,2]]]);
//# sourceMappingURL=main.37b4de99.chunk.js.map